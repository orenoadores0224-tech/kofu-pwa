<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>商売繁殖護符</title>
  <meta name="theme-color" content="#0b0b0f" />
  <link rel="icon" href="./icon-192.png" />
  <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
  <style>
    :root{
      --bg:#07070b; --panel:rgba(16,16,22,.74);
      --line:rgba(255,255,255,.10);
      --txt:rgba(255,255,255,.92); --sub:rgba(255,255,255,.60);
      --accent:#8b1b1b; --r:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;color:var(--txt);
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(139,27,27,.22), transparent 60%),
        radial-gradient(900px 500px at 80% 20%, rgba(255,214,120,.10), transparent 55%),
        var(--bg);
      font-family: ui-sans-serif, system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Yu Gothic", sans-serif;
      min-height:100svh;
    }
    .wrap{max-width:820px;margin:0 auto;padding:18px 16px 28px;position:relative;z-index:1}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:6px 2px 14px;border-bottom:1px solid rgba(255,255,255,.06);}
    a.back{color:rgba(255,255,255,.70);text-decoration:none;font-weight:700;letter-spacing:.06em;}
    h1{margin:14px 2px 6px;font-size:28px;letter-spacing:.06em}
    .lead{margin:0 2px 14px;color:var(--sub);line-height:1.65}

    .card{
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:var(--r);
      overflow:hidden;
      box-shadow: 0 18px 50px rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
    }
    .inner{padding:16px}
    .label{font-weight:800;letter-spacing:.06em;margin:0 0 10px}

    .photos{
      display:grid;
      grid-template-columns: 1.25fr .75fr; /* 大:小 */
      gap:12px;
    }
    .photo{
      border:1px solid rgba(255,255,255,.10);
      border-radius:12px;
      overflow:hidden;
      background:rgba(0,0,0,.22);
    }
    .photo img{display:block;width:100%;height:auto;object-fit:contain}
    .hint{margin-top:8px;color:rgba(255,255,255,.50);font-size:12px;line-height:1.6}

    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center}
    .file{flex:1;min-width:240px;border:1px solid rgba(255,255,255,.12);padding:10px 12px;border-radius:12px;background:rgba(0,0,0,.18);display:flex;gap:10px;align-items:center}
    .file span{color:rgba(255,255,255,.55);font-weight:800;letter-spacing:.08em}
    input[type="file"]{width:100%}
    .btn{border:1px solid rgba(255,255,255,.14);background:rgba(0,0,0,.22);color:rgba(255,255,255,.92);border-radius:12px;padding:12px 14px;font-weight:900;letter-spacing:.10em;cursor:pointer}
    .btn.primary{border-color:rgba(139,27,27,.55);box-shadow:0 0 0 1px rgba(139,27,27,.30) inset}

    #dust{position:fixed;inset:0;pointer-events:none;z-index:0;opacity:.50}
  </style>
</head>
<body>
<canvas id="dust"></canvas>

<div class="wrap">
  <div class="top">
    <a class="back" href="./index.html">← 護符にもどる</a>
    <div style="color:rgba(255,255,255,.35);font-weight:800;letter-spacing:.24em">SHOBAI</div>
  </div>

  <h1>商売繁殖護符</h1>
  <p class="lead">写真2枚（大・小）を封入する。固定画像は使わない。</p>

  <section class="card">
    <div class="inner">
      <div class="label">写真（大・小）</div>

      <div class="photos">
        <div class="photo"><img id="big" alt="big" src="" style="display:none"></div>
        <div class="photo"><img id="small" alt="small" src="" style="display:none"></div>
      </div>

      <div class="row">
        <div class="file">
          <span>大</span><input id="bigFile" type="file" accept="image/*" />
        </div>
        <div class="file">
          <span>小</span><input id="smallFile" type="file" accept="image/*" />
        </div>
        <button class="btn primary" id="seal">封入（封印）</button>
      </div>

      <div class="hint">
        ・ズレ防止：<b>高さ固定なし</b>で自然比率表示。<br/>
        ・前回の写真は端末内に記憶（PWAで便利）。
      </div>
    </div>
  </section>

  <div style="margin-top:14px;">
    <a class="back" href="./index.html">← もどる</a>
  </div>
</div>

<script>
  const big = document.getElementById('big');
  const small = document.getElementById('small');
  const KEYB='shobai_big', KEYS='shobai_small';

  const sb = localStorage.getItem(KEYB);
  const ss = localStorage.getItem(KEYS);
  if(sb){ big.src=sb; big.style.display='block'; }
  if(ss){ small.src=ss; small.style.display='block'; }

  function bind(input, img, key){
    input.addEventListener('change', () => {
      const f = input.files && input.files[0];
      if(!f) return;
      const r = new FileReader();
      r.onload = () => { img.src=r.result; img.style.display='block'; localStorage.setItem(key, r.result); };
      r.readAsDataURL(f);
    });
  }
  bind(document.getElementById('bigFile'), big, KEYB);
  bind(document.getElementById('smallFile'), small, KEYS);

  document.getElementById('seal').addEventListener('click', () => {
    if(!big.src || !small.src){
      alert('大・小の写真を両方選択してください');
      return;
    }
    navigator.vibrate && navigator.vibrate([30,30,60]);
    alert('封入しました');
  });

  // 金粉（控えめ）
  (function(){
    const reduce = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    if(reduce) return;
    const c = document.getElementById('dust');
    const ctx = c.getContext('2d');
    let w,h,dpr;
    function resize(){
      dpr = Math.min(2, devicePixelRatio||1);
      w = c.width = Math.floor(innerWidth*dpr);
      h = c.height = Math.floor(innerHeight*dpr);
      c.style.width = innerWidth+'px';
      c.style.height = innerHeight+'px';
    }
    addEventListener('resize', resize, {passive:true});
    resize();

    const N = Math.max(16, Math.min(60, Math.floor((innerWidth*innerHeight)/32000)));
    const ps = Array.from({length:N}, () => ({
      x: Math.random()*w, y: Math.random()*h,
      r: (Math.random()*1.2+0.5)*dpr,
      vx:(Math.random()*0.16+0.03)*dpr,
      vy:(Math.random()*0.12+0.04)*dpr,
      a: Math.random()*0.40+0.10
    }));
    function tick(){
      ctx.clearRect(0,0,w,h);
      for(const p of ps){
        p.x+=p.vx; p.y+=p.vy;
        if(p.x>w+20) p.x=-20;
        if(p.y>h+20) p.y=-20;
        ctx.beginPath();
        ctx.fillStyle=`rgba(255,214,120,${p.a})`;
        ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
        ctx.fill();
      }
      requestAnimationFrame(tick);
    }
    tick();
  })();
</script>
</body>
</html>